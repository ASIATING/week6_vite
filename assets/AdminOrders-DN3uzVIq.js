import{a as _}from"./axios-Bo0ATomq.js";import{_ as M,o as i,c as r,a as e,q as h,v as p,t as l,K as $,F as O,k,d as D,r as b,b as f}from"./index-B7hP1S-x.js";import{P as E}from"./PaginationArea-Bfg5ebp4.js";var V={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:g,VITE_PATH:v}=V,P={data(){return{tempOrderData:{user:{}},OrderModal:null,editMode:!1}},mounted(){this.OrderModal=new window.bootstrap.Modal(this.$refs.OrderModal,{keyboard:!1,backdrop:"static"})},methods:{openModal(o){this.editMode=!1,this.tempOrderData={...o},this.OrderModal.show()},formatDate(o){const s=new Date(o*1e3),n=s.getFullYear(),m=("0"+(s.getMonth()+1)).slice(-2),t=("0"+s.getDate()).slice(-2);return`${n}-${m}-${t}`},editOrder(o){this.editMode&&_.put(`${g}/api/${v}/admin/order/${o}`,{data:this.tempOrderData}).then(s=>{this.$emit("update"),this.OrderModal.hide()}).catch(s=>{alert(s)}),this.editMode=!this.editMode},delOrder(o){_.delete(`${g}/api/${v}/admin/order/${o}`)}}},T={class:"modal fade",id:"OrderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"OrderModal"},A={class:"modal-dialog modal-xl modal-dialog-centered"},I={class:"modal-content"},C=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"產品詳情"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),U={class:"modal-body"},L={class:"row border-bottom mb-3"},S={class:"col-6"},R=e("h5",{class:"mb-3 fw-bold"},"訂購人資訊",-1),B={class:"mb-3"},H=e("p",{class:"mb-1"},"訂購人",-1),F=["readonly","disabled"],N={class:"mb-3"},q=e("p",{class:"mb-1"},"訂購信箱",-1),Y=["readonly","disabled"],z={class:"mb-3"},K=e("p",{class:"mb-1"},"訂購電話",-1),j=["readonly","disabled"],G={class:"mb-3"},J=e("p",{class:"mb-1"},"訂購地址",-1),Q=["readonly","disabled"],W={class:"mb-3"},X=e("p",{class:"mb-1"},"訂購人訊息",-1),Z={class:"col-6"},ee=e("h5",{class:"mb-3 fw-bold"},"訂單資訊",-1),te={class:"mb-3"},se=e("p",{class:"mb-1"},"訂單編號",-1),oe={class:"mb-1"},de={class:"mb-3"},ae=e("p",{class:"mb-1"},"訂單時間",-1),le={class:"mb-1"},ne={class:"mb-3"},ie=e("p",{class:"mb-1"},"訂單金額",-1),re={class:"mb-1"},ce={class:"mb-3"},me=e("p",{class:"mb-1"},"訂單付款狀態",-1),he={class:"form-check"},_e={key:0,class:"form-check-label text-success",for:"flexCheckDefault"},pe={key:1,class:"form-check-label",for:"flexCheckDefault"},ue=e("h5",{class:"mb-3 fw-bold"},"訂單內容",-1),be={class:"table"},fe=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"編號"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"金額")])],-1),Oe={class:"modal-footer"},Me=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1);function De(o,s,n,m,t,a){return i(),r("div",T,[e("div",A,[e("div",I,[C,e("div",U,[e("div",L,[e("div",S,[R,e("div",B,[H,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=d=>t.tempOrderData.user.name=d),readonly:!t.editMode,disabled:!t.editMode},null,8,F),[[p,t.tempOrderData.user.name]])]),e("div",N,[q,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=d=>t.tempOrderData.user.email=d),readonly:!t.editMode,disabled:!t.editMode},null,8,Y),[[p,t.tempOrderData.user.email]])]),e("div",z,[K,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=d=>t.tempOrderData.user.tel=d),readonly:!t.editMode,disabled:!t.editMode},null,8,j),[[p,t.tempOrderData.user.tel]])]),e("div",G,[J,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=d=>t.tempOrderData.user.address=d),readonly:!t.editMode,disabled:!t.editMode},null,8,Q),[[p,t.tempOrderData.user.address]])]),e("div",W,[X,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=d=>t.tempOrderData.message=d),readonl:"",disabled:""},null,512),[[p,t.tempOrderData.message]])])]),e("div",Z,[ee,e("div",te,[se,e("p",oe,l(t.tempOrderData.id),1)]),e("div",de,[ae,e("p",le,l(a.formatDate(t.tempOrderData.create_at)),1)]),e("div",ne,[ie,e("p",re,l(t.tempOrderData.total),1)]),e("div",ce,[me,e("div",he,[h(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":s[5]||(s[5]=d=>t.tempOrderData.is_paid=d)},null,512),[[$,t.tempOrderData.is_paid]]),t.tempOrderData.is_paid?(i(),r("label",_e," 已付款 ")):(i(),r("label",pe," 未付款 "))])])])]),ue,e("table",be,[fe,e("tbody",null,[(i(!0),r(O,null,k(t.tempOrderData.products,(d,u)=>(i(),r("tr",{key:d.id},[e("td",null,l(u),1),e("td",null,l(d.product.title),1),e("td",null,l(d.qty),1),e("td",null,l(d.total),1)]))),128))])])]),e("div",Oe,[Me,e("button",{type:"button",class:"btn btn-outline-danger",onClick:s[6]||(s[6]=d=>a.delOrder(t.tempOrderData.id))}," 刪除 "),e("button",{type:"button",class:"btn btn-primary",onClick:s[7]||(s[7]=d=>a.editOrder(t.tempOrderData.id))},l(t.editMode?"保存":"編輯"),1)])])])],512)}const ge=M(P,[["render",De]]),ve={props:["item"],data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"ting-hexschool",delOrderModal:null}},mounted(){this.delOrderModal=new window.bootstrap.Modal(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"})},methods:{delOrder(){_.delete(`${this.apiUrl}/api/${this.apiPath}/admin/Order/${this.item.id}`).then(o=>{this.hideModal(),this.$emit("update")}).catch(o=>{alert(o.response.data.message)})},openModal(){this.delOrderModal.show()},hideModal(){this.delOrderModal.hide()}}},ye={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},ke={class:"modal-dialog"},xe={class:"modal-content border-0"},we=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delOrderModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),$e={class:"modal-body"},Ee={class:"text-danger"},Ve={class:"modal-footer"},Pe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Te(o,s,n,m,t,a){return i(),r("div",ye,[e("div",ke,[e("div",xe,[we,e("div",$e,[D(" 是否刪除 "),e("strong",Ee,l(n.item.id),1),D(" 訂單(刪除後將無法恢復)。 ")]),e("div",Ve,[Pe,e("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=(...d)=>a.delOrder&&a.delOrder(...d))}," 確認刪除 ")])])])],512)}const Ae=M(ve,[["render",Te]]);var Ie={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:y,VITE_PATH:Ce}=Ie,Ue={components:{OrderModal:ge,Pagination:E,DelOrderModal:Ae},mounted(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");_.defaults.headers.common.Authorization=o,this.getData()},data(){return{tempOrder:{},ordersData:[],pagination:{}}},methods:{checkAdmin(){const o=`${y}/api/user/check`;_.post(o).then(()=>{this.getData()}).catch(s=>{alert(s.response.data.message),this.$router.push("/login")})},getData(o=1){const s=`${y}/api/${Ce}/admin/orders?page=${o}`;_.get(s).then(n=>{const{orders:m,pagination:t}=n.data;this.ordersData=m,this.pagination=t}).catch(n=>{alert(n.response.data.message),this.$router.push("/login")})},openModal(o,s){this.tempOrder={...o},s==="edit"&&this.$refs.EditOrderModal.openModal(o),s==="delete"&&this.$refs.DelOrderModal.openModal(o)},formatDate(o){const s=new Date(o*1e3),n=s.getFullYear(),m=("0"+(s.getMonth()+1)).slice(-2),t=("0"+s.getDate()).slice(-2);return`${n}-${m}-${t}`}}},Le=e("h3",{class:"fw-bold mt-5"}," 後臺訂單列表 ",-1),Se={class:"container"},Re={class:"table mt-4"},Be=e("thead",null,[e("tr",null,[e("th",{width:"120"}," 訂單編號 "),e("th",{width:"90"},"購買人"),e("th",{width:"90"}," email "),e("th",{width:"90"}," 購買日期 "),e("th",{width:"90"}," 訂單金額 "),e("th",{width:"90"}," 訂單狀態 "),e("th",{width:"120"}," 編輯 ")])],-1),He={key:0,class:"text-success"},Fe={key:1},Ne={class:"d-grid gap-2 d-md-flex"},qe=["onClick"],Ye=["onClick"];function ze(o,s,n,m,t,a){const d=b("order-modal"),u=b("del-order-modal"),x=b("Pagination");return i(),r(O,null,[Le,e("div",Se,[e("table",Re,[Be,e("tbody",null,[(i(!0),r(O,null,k(t.ordersData,c=>(i(),r("tr",{key:c.id},[e("td",null,l(c.id),1),e("td",null,l(c.user.name),1),e("td",null,l(c.user.email),1),e("td",null,l(a.formatDate(c.create_at)),1),e("td",null,l(c.total),1),e("td",null,[c.is_paid?(i(),r("span",He,"已付款")):(i(),r("span",Fe,"未付款"))]),e("td",null,[e("div",Ne,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>a.openModal(c,"edit")}," 詳情 ",8,qe),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>a.openModal(c,"delete")}," 刪除 ",8,Ye)])])]))),128))])]),f(d,{ref:"EditOrderModal","temp-order":t.tempOrder,onUpdate:a.getData},null,8,["temp-order","onUpdate"]),f(u,{ref:"DelOrderModal",item:t.tempOrder,onUpdate:a.getData},null,8,["item","onUpdate"]),f(x,{pagination:t.pagination,onEmitPages:a.getData},null,8,["pagination","onEmitPages"])])],64)}const Je=M(Ue,[["render",ze]]);export{Je as default};
