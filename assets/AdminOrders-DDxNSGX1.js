import{a as _}from"./axios-Bo0ATomq.js";import{_ as D,M as k,o as i,c as r,a as e,q as h,v as p,t as l,K as V,F as M,j as x,d as O,r as b,b as f}from"./index-KN1Iini3.js";import{p as E}from"./PaginationArea-tUFXKf51.js";var T={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:g,VITE_PATH:v}=T,P={data(){return{tempOrderData:{user:{}},orderModal:null,editMode:!1}},mounted(){this.orderModal=new k(this.$refs.orderModal,{keyboard:!1,backdrop:"static"})},methods:{openModal(o){this.editMode=!1,this.tempOrderData={...o},this.orderModal.show()},formatDate(o){const s=new Date(o*1e3),n=s.getFullYear(),m=("0"+(s.getMonth()+1)).slice(-2),t=("0"+s.getDate()).slice(-2);return`${n}-${m}-${t}`},editOrder(o){this.editMode&&_.put(`${g}/api/${v}/admin/order/${o}`,{data:this.tempOrderData}).then(s=>{this.$emit("update"),this.orderModal.hide()}).catch(s=>{alert(s)}),this.editMode=!this.editMode},delOrder(o){_.delete(`${g}/api/${v}/admin/order/${o}`)}}},A={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},I={class:"modal-dialog modal-xl modal-dialog-centered"},C={class:"modal-content"},U=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"產品詳情"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),L={class:"modal-body"},S={class:"row border-bottom mb-3"},R={class:"col-6"},B=e("h5",{class:"mb-3 fw-bold"},"訂購人資訊",-1),H={class:"mb-3"},F=e("p",{class:"mb-1"},"訂購人",-1),N=["readonly","disabled"],q={class:"mb-3"},Y=e("p",{class:"mb-1"},"訂購信箱",-1),j=["readonly","disabled"],z={class:"mb-3"},K=e("p",{class:"mb-1"},"訂購電話",-1),G=["readonly","disabled"],J={class:"mb-3"},Q=e("p",{class:"mb-1"},"訂購地址",-1),W=["readonly","disabled"],X={class:"mb-3"},Z=e("p",{class:"mb-1"},"訂購人訊息",-1),ee={class:"col-6"},te=e("h5",{class:"mb-3 fw-bold"},"訂單資訊",-1),se={class:"mb-3"},oe=e("p",{class:"mb-1"},"訂單編號",-1),de={class:"mb-1"},ae={class:"mb-3"},le=e("p",{class:"mb-1"},"訂單時間",-1),ne={class:"mb-1"},ie={class:"mb-3"},re=e("p",{class:"mb-1"},"訂單金額",-1),ce={class:"mb-1"},me={class:"mb-3"},he=e("p",{class:"mb-1"},"訂單付款狀態",-1),_e={class:"form-check"},pe={key:0,class:"form-check-label text-success",for:"flexCheckDefault"},ue={key:1,class:"form-check-label",for:"flexCheckDefault"},be=e("h5",{class:"mb-3 fw-bold"},"訂單內容",-1),fe={class:"table"},Me=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"編號"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"金額")])],-1),De={class:"modal-footer"},Oe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1);function ge(o,s,n,m,t,a){return i(),r("div",A,[e("div",I,[e("div",C,[U,e("div",L,[e("div",S,[e("div",R,[B,e("div",H,[F,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=d=>t.tempOrderData.user.name=d),readonly:!t.editMode,disabled:!t.editMode},null,8,N),[[p,t.tempOrderData.user.name]])]),e("div",q,[Y,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=d=>t.tempOrderData.user.email=d),readonly:!t.editMode,disabled:!t.editMode},null,8,j),[[p,t.tempOrderData.user.email]])]),e("div",z,[K,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=d=>t.tempOrderData.user.tel=d),readonly:!t.editMode,disabled:!t.editMode},null,8,G),[[p,t.tempOrderData.user.tel]])]),e("div",J,[Q,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=d=>t.tempOrderData.user.address=d),readonly:!t.editMode,disabled:!t.editMode},null,8,W),[[p,t.tempOrderData.user.address]])]),e("div",X,[Z,h(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=d=>t.tempOrderData.message=d),readonl:"",disabled:""},null,512),[[p,t.tempOrderData.message]])])]),e("div",ee,[te,e("div",se,[oe,e("p",de,l(t.tempOrderData.id),1)]),e("div",ae,[le,e("p",ne,l(a.formatDate(t.tempOrderData.create_at)),1)]),e("div",ie,[re,e("p",ce,l(t.tempOrderData.total),1)]),e("div",me,[he,e("div",_e,[h(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":s[5]||(s[5]=d=>t.tempOrderData.is_paid=d)},null,512),[[V,t.tempOrderData.is_paid]]),t.tempOrderData.is_paid?(i(),r("label",pe," 已付款 ")):(i(),r("label",ue," 未付款 "))])])])]),be,e("table",fe,[Me,e("tbody",null,[(i(!0),r(M,null,x(t.tempOrderData.products,(d,u)=>(i(),r("tr",{key:d.id},[e("td",null,l(u),1),e("td",null,l(d.product.title),1),e("td",null,l(d.qty),1),e("td",null,l(d.total),1)]))),128))])])]),e("div",De,[Oe,e("button",{type:"button",class:"btn btn-outline-danger",onClick:s[6]||(s[6]=d=>a.delOrder(t.tempOrderData.id))}," 刪除 "),e("button",{type:"button",class:"btn btn-primary",onClick:s[7]||(s[7]=d=>a.editOrder(t.tempOrderData.id))},l(t.editMode?"保存":"編輯"),1)])])])],512)}const ve=D(P,[["render",ge]]),ye={props:["item"],data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"ting-hexschool",delOrderModal:null}},mounted(){this.delOrderModal=new k(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"})},methods:{delOrder(){_.delete(`${this.apiUrl}/api/${this.apiPath}/admin/Order/${this.item.id}`).then(o=>{this.hideModal(),this.$emit("update")}).catch(o=>{alert(o.response.data.message)})},openModal(){this.delOrderModal.show()},hideModal(){this.delOrderModal.hide()}}},ke={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},xe={class:"modal-dialog"},$e={class:"modal-content border-0"},we=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delOrderModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ve={class:"modal-body"},Ee={class:"text-danger"},Te={class:"modal-footer"},Pe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ae(o,s,n,m,t,a){return i(),r("div",ke,[e("div",xe,[e("div",$e,[we,e("div",Ve,[O(" 是否刪除 "),e("strong",Ee,l(n.item.id),1),O(" 訂單(刪除後將無法恢復)。 ")]),e("div",Te,[Pe,e("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=(...d)=>a.delOrder&&a.delOrder(...d))}," 確認刪除 ")])])])],512)}const Ie=D(ye,[["render",Ae]]);var Ce={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:y,VITE_PATH:Ue}=Ce,Le={components:{orderModal:ve,Pagination:E,delOrderModal:Ie},mounted(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");_.defaults.headers.common.Authorization=o,this.getData()},data(){return{tempOrder:{},ordersData:[],pagination:{}}},methods:{checkAdmin(){const o=`${y}/api/user/check`;_.post(o).then(()=>{this.getData()}).catch(s=>{alert(s.response.data.message),this.$router.push("/login")})},getData(o=1){const s=`${y}/api/${Ue}/admin/orders?page=${o}`;_.get(s).then(n=>{const{orders:m,pagination:t}=n.data;this.ordersData=m,this.pagination=t}).catch(n=>{alert(n.response.data.message),this.$router.push("/login")})},openModal(o,s){this.tempOrder={...o},s==="edit"&&this.$refs.editOrderModal.openModal(o),s==="delete"&&this.$refs.delOrderModal.openModal(o)},formatDate(o){const s=new Date(o*1e3),n=s.getFullYear(),m=("0"+(s.getMonth()+1)).slice(-2),t=("0"+s.getDate()).slice(-2);return`${n}-${m}-${t}`}}},Se=e("h3",{class:"fw-bold mt-5"}," 後臺訂單列表 ",-1),Re={class:"container"},Be={class:"table mt-4"},He=e("thead",null,[e("tr",null,[e("th",{width:"120"}," 訂單編號 "),e("th",{width:"90"},"購買人"),e("th",{width:"90"}," email "),e("th",{width:"90"}," 購買日期 "),e("th",{width:"90"}," 訂單金額 "),e("th",{width:"90"}," 訂單狀態 "),e("th",{width:"120"}," 編輯 ")])],-1),Fe={key:0,class:"text-success"},Ne={key:1},qe={class:"d-grid gap-2 d-md-flex"},Ye=["onClick"],je=["onClick"];function ze(o,s,n,m,t,a){const d=b("order-modal"),u=b("del-order-modal"),$=b("pagination");return i(),r(M,null,[Se,e("div",Re,[e("table",Be,[He,e("tbody",null,[(i(!0),r(M,null,x(t.ordersData,c=>(i(),r("tr",{key:c.id},[e("td",null,l(c.id),1),e("td",null,l(c.user.name),1),e("td",null,l(c.user.email),1),e("td",null,l(a.formatDate(c.create_at)),1),e("td",null,l(c.total),1),e("td",null,[c.is_paid?(i(),r("span",Fe,"已付款")):(i(),r("span",Ne,"未付款"))]),e("td",null,[e("div",qe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>a.openModal(c,"edit")}," 詳情 ",8,Ye),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>a.openModal(c,"delete")}," 刪除 ",8,je)])])]))),128))])]),f(d,{ref:"editOrderModal","temp-order":t.tempOrder,onUpdate:a.getData},null,8,["temp-order","onUpdate"]),f(u,{ref:"delOrderModal",item:t.tempOrder,onUpdate:a.getData},null,8,["item","onUpdate"]),f($,{pagination:t.pagination,onEmitPages:a.getData},null,8,["pagination","onEmitPages"])])],64)}const Qe=D(Le,[["render",ze]]);export{Qe as default};
