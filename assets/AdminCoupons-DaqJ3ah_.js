import{a as u}from"./axios-Bo0ATomq.js";import{p as V}from"./PaginationArea-Dkt-cieF.js";import{_ as w,M as $,r,o as i,c,d as l,w as y,a as e,x as M,l as x,K as P,b as C,t as b,F as E,j as D}from"./index-DWRIMk-I.js";import{d as T}from"./delProductModal-D8qI6_nb.js";var A={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:f,VITE_PATH:k}=A,I={props:["tempCoupon"],data(){return{isLoding:!0,productModal:null,products:[],isNew:!0,coupon:{title:"132",is_enabled:1,percent:"",due_date:"",code:""}}},mounted(){this.productModal=new $(this.$refs.productModal,{keyboard:!1,backdrop:"static"}),console.log(this.productModal)},methods:{checkLogin(){u.post(`${f}/api/user/check`).then(o=>{console.log(o.data)}).catch(o=>{console.dir(o)})},openModal(o,t){console.log(333),o==="new"?(this.isNew=!0,this.coupon={is_enabled:0},this.productModal.show()):o==="edit"?(console.log(444),this.isNew=!1,console.log(this.isNew),this.coupon={...t},this.productModal.show(),console.log(this.tempProduct)):o==="delete"&&(this.isNew=!1,this.tempProduct={...t},this.delProductModal.show())},submitBtn(){console.log("submitBtn"),this.isNew?(console.log("this.isNew",this.isNew),this.coupon.due_date=new Date(this.coupon.due_date).getTime(),u.post(`${f}/api/${k}/admin/coupon/`,{data:this.coupon}).then(o=>{console.log(o.data),this.$emit("update"),this.productModal.hide()}).catch(o=>{alert(o.response.data.message)})):u.put(`${f}/api/${k}/admin/coupon/${this.coupon.id}`,{data:this.coupon}).then(o=>{console.log(o.data),this.$emit("update"),this.productModal.hide()}).catch(o=>{alert(o.response.data.message)})},deletBtn(){u.delete(`${f}/api/${k}/admin/coupon/${this.coupon.id}`).then(o=>{console.log(o.data),this.delProductModal.hide(),alert("刪除成功")}).catch(o=>{console.dir(o)})}}},U={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},B={class:"modal-content border-0"},N={class:"modal-header bg-dark text-white"},S={id:"productModalLabel",class:"modal-title"},H={key:0},L={key:1},R=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},q={class:"mb-3"},j=e("label",{for:"name",class:"form-label"},"優惠券名稱",-1),z={class:"mb-3"},F=e("label",{for:"tel",class:"form-label"},"折扣碼",-1),K={class:"mb-3"},G=e("label",{for:"address",class:"form-label"},"折扣%數",-1),J={class:"mb-3"},Q=e("label",{for:"message",class:"form-label"},"到期日",-1),W={class:"mb-3"},X={class:"form-check"},Y=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Z=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{type:"submit",class:"btn btn-primary"}," 確認 ")],-1);function ee(o,t,p,g,s,d){const h=r("v-field"),_=r("error-message"),v=r("VueDatePicker"),n=r("v-form");return i(),c("div",U,[l(n,{class:"modal-dialog modal-xl",onSubmit:d.submitBtn,ref:"form"},{default:y(({errors:m})=>[e("div",B,[e("div",N,[e("h5",S,[s.isNew?(i(),c("span",H,"新增優惠券")):(i(),c("span",L,"編輯優惠券"))]),R]),e("div",O,[e("div",q,[j,l(h,{id:"name",name:"名稱",type:"text",class:M(["form-control",{"is-invalid":m.名稱}]),placeholder:"請輸入優惠卷名稱",rules:"required",modelValue:s.coupon.title,"onUpdate:modelValue":t[0]||(t[0]=a=>s.coupon.title=a)},null,8,["class","modelValue"]),l(_,{name:"名稱",class:"invalid-feedback"})]),e("div",z,[F,l(h,{id:"tel",name:"折扣碼",type:"text",class:M(["form-control",{"is-invalid":m.折扣碼}]),placeholder:"請輸入折扣碼",rules:"required",modelValue:s.coupon.code,"onUpdate:modelValue":t[1]||(t[1]=a=>s.coupon.code=a)},null,8,["class","modelValue"]),l(_,{name:"折扣碼",class:"invalid-feedback"})]),e("div",K,[G,l(h,{id:"address",name:"折扣數",type:"number",class:M(["form-control",{"is-invalid":m.折扣數}]),placeholder:"折扣數",rules:"required",modelValue:s.coupon.percent,"onUpdate:modelValue":t[2]||(t[2]=a=>s.coupon.percent=a)},null,8,["class","modelValue"]),l(_,{name:"折扣數",class:"invalid-feedback"})]),e("div",J,[Q,l(v,{id:"due_date","text-input":"",format:"yyyy/MM/dd HH:mm",modelValue:s.coupon.due_date,"onUpdate:modelValue":t[3]||(t[3]=a=>s.coupon.due_date=a),"min-date":new Date,clearable:!1},null,8,["modelValue","min-date"])]),e("div",W,[e("div",X,[x(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=a=>s.coupon.is_enabled=a)},null,512),[[P,s.coupon.is_enabled]]),Y])]),C(" "+b(s.coupon),1)]),Z])]),_:1},8,["onSubmit"])],512)}const oe=w(I,[["render",ee]]);var te={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:se,VITE_PATH:ne}=te,le={components:{pagination:V,editCouponModal:oe,delProductModal:T},data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"ting-hexschool",coupons:[],tempCoupon:{},pagination:{},isNew:!1}},mounted(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");u.defaults.headers.common.Authorization=o,this.checkAdmin(),this.getData()},methods:{checkAdmin(){const o=`${this.apiUrl}/api/user/check`;u.post(o).then(()=>{this.getData()}).catch(t=>{alert(t.response.data.message),this.$router.push("/login")})},getData(o=1){const t=`${se}/api/${ne}/admin/coupons`;u.get(t).then(p=>{console.log(222,p.data);const{coupons:g,pagination:s}=p.data;this.coupons=g,this.pagination=s}).catch(p=>{alert(p.response.data.message),this.$router.push("/login")})},openModal(o,t){o==="new"?(this.tempCoupon={},this.isNew=!0,this.$refs.editCouponModal.openModal(o,t)):o==="edit"?(this.tempCoupon={...t},this.isNew=!1,this.$refs.editCouponModal.openModal(o,t)):o==="delete"&&(this.tempCoupon={...t},this.$refs.delProductModal.openModal(o,t))}}},ae={id:"app"},de={class:"container"},ie=e("h3",{class:"fw-bold mt-5"}," 後台優惠卷列表 ",-1),ce={class:"d-flex mt-4 justify-content-between"},ue=e("div",null,null,-1),re={class:"ml-auto"},pe={class:"table mt-4"},he=e("thead",null,[e("tr",null,[e("th",{width:"120"},"優惠券名稱"),e("th",{width:"120"},"折扣碼"),e("th",{width:"120"}," 到期日 "),e("th",{width:"60"}," 優惠折數(%) "),e("th",{width:"60"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),_e={class:"text-center"},me={class:"text-center"},be={key:0,class:"text-success"},fe={key:1},ge={class:"btn-group"},ve=["onClick"],Me=["onClick"];function ke(o,t,p,g,s,d){const h=r("pagination"),_=r("edit-coupon-modal"),v=r("del-product-modal");return i(),c("div",ae,[e("div",de,[ie,e("div",ce,[ue,e("div",re,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=n=>d.openModal("new"))}," 建立新的產品 ")])]),e("table",pe,[he,e("tbody",null,[(i(!0),c(E,null,D(s.coupons,n=>(i(),c("tr",{key:n.id},[e("td",null,b(n.title),1),e("td",null,b(n.code),1),e("td",_e,b(n.due_date),1),e("td",me,b(n.percent),1),e("td",null,[n.is_enabled?(i(),c("span",be,"啟用")):(i(),c("span",fe,"未啟用"))]),e("td",null,[e("div",ge,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:m=>d.openModal("edit",n)}," 編輯 ",8,ve),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:m=>d.openModal("delete",n)}," 刪除 ",8,Me)])])]))),128))])]),l(h,{pagination:s.pagination,onEmitPages:d.getData},null,8,["pagination","onEmitPages"])]),l(_,{ref:"editCouponModal",coupon:s.tempCoupon,"is-new":s.isNew,onUpdate:d.getData},null,8,["coupon","is-new","onUpdate"]),l(v,{ref:"delProductModal",item:s.tempCoupon,apiMethod:"coupon",onUpdate:d.getData},null,8,["item","onUpdate"])])}const xe=w(le,[["render",ke]]);export{xe as default};
