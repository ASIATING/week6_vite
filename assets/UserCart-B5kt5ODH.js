import{a as c}from"./axios-Bo0ATomq.js";import{_ as V,r as b,o as n,c as i,a as e,F as k,g as U,i as m,t as u,b as d,w as I,d as v,e as x,v as y,n as f}from"./index-BT6PyEIl.js";const q={data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2/",apiPath:"ting-hexschool",isLoading:!0,products:[],cart:{},qty:1,tempProduct:{},productModal:null,loadingItem:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},mounted(){this.getCart()},methods:{getCart(){const a=`${this.apiUrl}/api/${this.apiPath}/cart`;c.get(a).then(t=>{console.log(t),this.cart=t.data.data}).catch(t=>{alert(t.response.data.message)})},addToCart(a,t=1){this.loadingItem=a;const r=`${this.apiUrl}/api/${this.apiPath}/cart`;c.post(r,{data:{product_id:a,qty:t}}).then(p=>{this.loadingItem="",alert(p.data.message),this.$refs.userProductModal.hideModal(),this.getCart()}).catch(p=>{alert(p.response.data.message)})},updateCart(a){this.loadingItem=a.id;const t=`${this.apiUrl}/api/${this.apiPath}/cart/${a.id}`;c.put(t,{data:{product_id:a.product_id,qty:a.qty}}).then(r=>{this.loadingItem="",alert(r.data.message),this.getCart()}).catch(r=>{this.loadingItem="",alert(r.response.data.message)})},removeCartItem(a){const t=`${this.apiUrl}/api/${this.apiPath}/cart/${a}`;this.loadingItem=a,c.delete(t).then(r=>{this.loadingItem="",alert(r.data.message),this.getCart()}).catch(r=>{alert(r.response.data.message)})},clearCart(){const a=`${this.apiUrl}/api/${this.apiPath}/carts`;c.delete(a).then(t=>{alert(t.data.message),this.getCart()}).catch(t=>{alert(t.response.data.message)})}}},P={class:"text-end"},w={class:"table align-middle"},B=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),M=["onClick"],N={key:0,class:"fas fa-spinner fa-pulse"},E={key:1},O={key:0,class:"text-success"},S={class:"input-group input-group-sm"},T={class:"input-group mb-3"},D=["onUpdate:modelValue","onBlur"],F={class:"input-group-text",id:"basic-addon2"},L={class:"text-end"},j={key:0,class:"text-success"},z=e("td",{colspan:"3",class:"text-end"},"總計",-1),A={class:"text-end"},G={key:0},H=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),J={class:"text-end text-success"},K={class:"my-5 row justify-content-center"},Q={class:"mb-3"},R=e("label",{for:"email",class:"form-label"},"Email",-1),W={class:"mb-3"},X=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),Y={class:"mb-3"},Z=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),$={class:"mb-3"},ee=e("label",{for:"address",class:"form-label"},"收件人地址",-1),te={class:"mb-3"},se=e("label",{for:"message",class:"form-label"},"留言",-1),ae={class:"text-end"},le=["disabled"],oe={key:0,class:"fas fa-spinner fa-pulse"};function re(a,t,r,p,s,g){const h=b("v-field"),_=b("error-message"),C=b("v-form");return n(),i("div",null,[e("div",P,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:t[0]||(t[0]=l=>g.clearCart())},"清空購物車")]),e("table",w,[B,e("tbody",null,[s.cart.carts?(n(!0),i(k,{key:0},U(s.cart.carts,l=>(n(),i("tr",{key:l},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>g.removeCartItem(l.id)},[s.loadingItem===l.id?(n(),i("i",N)):(n(),i("div",E,"x"))],8,M)]),e("td",null,[v(u(l.product.title)+" ",1),l.coupon?(n(),i("div",O," 已套用優惠券 ")):m("",!0)]),e("td",null,[e("div",S,[e("div",T,[x(e("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":o=>l.qty=o,onBlur:o=>g.updateCart(l)},null,40,D),[[y,l.qty,void 0,{number:!0}]]),e("span",F,u(l.product.unit),1)])])]),e("td",L,[s.cart.final_total!==s.cart.total?(n(),i("small",j,"折扣價：")):m("",!0),v(" "+u(l.final_total),1)])]))),128)):m("",!0)]),e("tfoot",null,[e("tr",null,[z,e("td",A,u(s.cart.total),1)]),s.cart.final_total!==s.cart.total?(n(),i("tr",G,[H,e("td",J,u(s.cart.final_total),1)])):m("",!0)])]),e("div",K,[d(C,{onSubmit:a.createOrder,ref:"form",class:"col-md-6"},{default:I(({errors:l})=>[e("div",Q,[R,d(h,{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=o=>s.form.user.email=o)},null,8,["class","modelValue"]),d(_,{name:"email",class:"invalid-feedback"})]),e("div",W,[X,d(h,{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=o=>s.form.user.name=o)},null,8,["class","modelValue"]),d(_,{name:"姓名",class:"invalid-feedback"})]),e("div",Y,[Z,d(h,{id:"tel",name:"電話",type:"text",class:f(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:s.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=o=>s.form.user.tel=o)},null,8,["class","modelValue"]),d(_,{name:"電話",class:"invalid-feedback"})]),e("div",$,[ee,d(h,{id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=o=>s.form.user.address=o)},null,8,["class","modelValue"]),d(_,{name:"地址",class:"invalid-feedback"})]),e("div",te,[se,x(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[5]||(t[5]=o=>s.form.message=o)},null,512),[[y,s.form.message]])]),e("div",ae,[e("button",{type:"submit",class:"btn btn-danger",disabled:s.cart.total===0||s.loadingItem==="createOrder"},[s.loadingItem==="createOrder"?(n(),i("i",oe)):m("",!0),v(" 送出訂單 ")],8,le)])]),_:1},8,["onSubmit"])])])}const de=V(q,[["render",re]]);export{de as default};
