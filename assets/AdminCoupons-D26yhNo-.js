import{a as u}from"./axios-Bo0ATomq.js";import{p as y}from"./PaginationArea-B6tc2E8N.js";import{_ as $,M as V,r,o as i,c,b as a,w,a as e,x as M,q as x,K as P,F as C,k as E,t as b}from"./index-D5Zkr7Lo.js";import{d as D}from"./delProductModal-C9ZH2Jz_.js";var T={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:f,VITE_PATH:k}=T,A={props:["tempCoupon"],data(){return{isLoding:!0,productModal:null,products:[],isNew:!0,coupon:{title:"132",is_enabled:1,percent:"",due_date:"",code:""}}},mounted(){this.productModal=new V(this.$refs.productModal,{keyboard:!1,backdrop:"static"})},methods:{checkLogin(){u.post(`${f}/api/user/check`).catch(t=>{alert(t)})},openModal(t,o){t==="new"?(this.isNew=!0,this.coupon={is_enabled:0},this.productModal.show()):t==="edit"?(this.isNew=!1,this.coupon={...o},this.productModal.show()):t==="delete"&&(this.isNew=!1,this.tempProduct={...o},this.delProductModal.show())},submitBtn(){this.isNew?(this.coupon.due_date=new Date(this.coupon.due_date).getTime(),u.post(`${f}/api/${k}/admin/coupon/`,{data:this.coupon}).then(t=>{this.$emit("update"),this.productModal.hide()}).catch(t=>{alert(t.response.data.message)})):u.put(`${f}/api/${k}/admin/coupon/${this.coupon.id}`,{data:this.coupon}).then(t=>{this.$emit("update"),this.productModal.hide()}).catch(t=>{alert(t.response.data.message)})},deletBtn(){u.delete(`${f}/api/${k}/admin/coupon/${this.coupon.id}`).then(t=>{this.delProductModal.hide(),alert("刪除成功")}).catch(t=>{alert(t)})}}},I={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},U={class:"modal-content border-0"},S={class:"modal-header bg-dark text-white"},B={id:"productModalLabel",class:"modal-title"},H={key:0},L={key:1},R=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),N={class:"modal-body"},q={class:"mb-3"},O=e("label",{for:"name",class:"form-label"},"優惠券名稱",-1),z={class:"mb-3"},F=e("label",{for:"tel",class:"form-label"},"折扣碼",-1),j={class:"mb-3"},K=e("label",{for:"address",class:"form-label"},"折扣%數",-1),G={class:"mb-3"},J=e("label",{for:"message",class:"form-label"},"到期日",-1),Q={class:"mb-3"},W={class:"form-check"},X=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Y=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{type:"submit",class:"btn btn-primary"}," 確認 ")],-1);function Z(t,o,p,v,s,d){const h=r("v-field"),_=r("error-message"),g=r("VueDatePicker"),n=r("v-form");return i(),c("div",I,[a(n,{class:"modal-dialog modal-xl",onSubmit:d.submitBtn,ref:"form"},{default:w(({errors:m})=>[e("div",U,[e("div",S,[e("h5",B,[s.isNew?(i(),c("span",H,"新增優惠券")):(i(),c("span",L,"編輯優惠券"))]),R]),e("div",N,[e("div",q,[O,a(h,{id:"name",name:"名稱",type:"text",class:M(["form-control",{"is-invalid":m.名稱}]),placeholder:"請輸入優惠卷名稱",rules:"required",modelValue:s.coupon.title,"onUpdate:modelValue":o[0]||(o[0]=l=>s.coupon.title=l)},null,8,["class","modelValue"]),a(_,{name:"名稱",class:"invalid-feedback"})]),e("div",z,[F,a(h,{id:"tel",name:"折扣碼",type:"text",class:M(["form-control",{"is-invalid":m.折扣碼}]),placeholder:"請輸入折扣碼",rules:"required",modelValue:s.coupon.code,"onUpdate:modelValue":o[1]||(o[1]=l=>s.coupon.code=l)},null,8,["class","modelValue"]),a(_,{name:"折扣碼",class:"invalid-feedback"})]),e("div",j,[K,a(h,{id:"address",name:"折扣數",type:"number",class:M(["form-control",{"is-invalid":m.折扣數}]),placeholder:"折扣數",rules:"required",modelValue:s.coupon.percent,"onUpdate:modelValue":o[2]||(o[2]=l=>s.coupon.percent=l)},null,8,["class","modelValue"]),a(_,{name:"折扣數",class:"invalid-feedback"})]),e("div",G,[J,a(g,{id:"due_date","text-input":"",format:"yyyy/MM/dd HH:mm",modelValue:s.coupon.due_date,"onUpdate:modelValue":o[3]||(o[3]=l=>s.coupon.due_date=l),"min-date":new Date,clearable:!1},null,8,["modelValue","min-date"])]),e("div",Q,[e("div",W,[x(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=l=>s.coupon.is_enabled=l)},null,512),[[P,s.coupon.is_enabled]]),X])])]),Y])]),_:1},8,["onSubmit"])],512)}const ee=$(A,[["render",Z]]);var te={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:oe,VITE_PATH:se}=te,ne={components:{pagination:y,editCouponModal:ee,delProductModal:D},data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"ting-hexschool",coupons:[],tempCoupon:{},pagination:{},isNew:!1}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");u.defaults.headers.common.Authorization=t,this.getData()},methods:{checkAdmin(){const t=`${this.apiUrl}/api/user/check`;u.post(t).then(()=>{this.getData()}).catch(o=>{alert(o.response.data.message),this.$router.push("/login")})},getData(t=1){const o=`${oe}/api/${se}/admin/coupons`;u.get(o).then(p=>{const{coupons:v,pagination:s}=p.data;this.coupons=v,this.pagination=s}).catch(p=>{alert(p.response.data.message),this.$router.push("/login")})},openModal(t,o){t==="new"?(this.tempCoupon={},this.isNew=!0,this.$refs.editCouponModal.openModal(t,o)):t==="edit"?(this.tempCoupon={...o},this.isNew=!1,this.$refs.editCouponModal.openModal(t,o)):t==="delete"&&(this.tempCoupon={...o},this.$refs.delProductModal.openModal(t,o))}}},ae={id:"app"},le={class:"container"},de=e("h3",{class:"fw-bold mt-5"}," 後台優惠卷列表 ",-1),ie={class:"d-flex mt-4 justify-content-between"},ce=e("div",null,null,-1),ue={class:"ml-auto"},re={class:"table mt-4"},pe=e("thead",null,[e("tr",null,[e("th",{width:"120"},"優惠券名稱"),e("th",{width:"120"},"折扣碼"),e("th",{width:"120"}," 到期日 "),e("th",{width:"60"}," 優惠折數(%) "),e("th",{width:"60"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),he={class:"text-center"},_e={class:"text-center"},me={key:0,class:"text-success"},be={key:1},fe={class:"btn-group"},ve=["onClick"],ge=["onClick"];function Me(t,o,p,v,s,d){const h=r("pagination"),_=r("edit-coupon-modal"),g=r("del-product-modal");return i(),c("div",ae,[e("div",le,[de,e("div",ie,[ce,e("div",ue,[e("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=n=>d.openModal("new"))}," 建立新優惠券 ")])]),e("table",re,[pe,e("tbody",null,[(i(!0),c(C,null,E(s.coupons,n=>(i(),c("tr",{key:n.id},[e("td",null,b(n.title),1),e("td",null,b(n.code),1),e("td",he,b(n.due_date),1),e("td",_e,b(n.percent),1),e("td",null,[n.is_enabled?(i(),c("span",me,"啟用")):(i(),c("span",be,"未啟用"))]),e("td",null,[e("div",fe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:m=>d.openModal("edit",n)}," 編輯 ",8,ve),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:m=>d.openModal("delete",n)}," 刪除 ",8,ge)])])]))),128))])]),a(h,{pagination:s.pagination,onEmitPages:d.getData},null,8,["pagination","onEmitPages"])]),a(_,{ref:"editCouponModal",coupon:s.tempCoupon,"is-new":s.isNew,onUpdate:d.getData},null,8,["coupon","is-new","onUpdate"]),a(g,{ref:"delProductModal",item:s.tempCoupon,apiMethod:"coupon",onUpdate:d.getData},null,8,["item","onUpdate"])])}const we=$(ne,[["render",Me]]);export{we as default};
