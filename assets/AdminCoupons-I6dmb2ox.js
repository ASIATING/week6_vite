import{a as u}from"./axios-Bo0ATomq.js";import{P}from"./PaginationArea-Bfg5ebp4.js";import{_ as y,r,o as d,c as i,b as l,w as V,a as e,x as k,q as w,u as D,F as $,k as x,t as b,d as E,K as C}from"./index-B7hP1S-x.js";import{D as T}from"./DelProductModal-mUihNDz-.js";var A={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:f,VITE_PATH:M}=A,I={props:["tempCoupon"],data(){return{isLoding:!0,productModal:null,products:[],isNew:!0,coupon:{title:"132",is_enabled:1,percent:"",due_date:"",code:""}}},mounted(){this.productModal=new window.bootstrap.Modal(this.$refs.productModal,{keyboard:!1,backdrop:"static"})},methods:{checkLogin(){u.post(`${f}/api/user/check`).catch(t=>{alert(t)})},openModal(t,o){t==="new"?(this.isNew=!0,this.coupon={is_enabled:0,percent:1},this.productModal.show()):t==="edit"?(this.isNew=!1,this.coupon={...o},this.productModal.show()):t==="delete"&&(this.isNew=!1,this.tempProduct={...o},this.DelProductModal.show())},submitBtn(){this.isNew?(this.coupon.due_date=new Date(this.coupon.due_date).getTime(),u.post(`${f}/api/${M}/admin/coupon/`,{data:this.coupon}).then(t=>{this.$emit("update"),this.productModal.hide()}).catch(t=>{alert(t.response.data.message)})):u.put(`${f}/api/${M}/admin/coupon/${this.coupon.id}`,{data:this.coupon}).then(t=>{this.$emit("update"),this.productModal.hide()}).catch(t=>{alert(t.response.data.message)})},deletBtn(){u.delete(`${f}/api/${M}/admin/coupon/${this.coupon.id}`).then(t=>{this.DelProductModal.hide(),alert("刪除成功")}).catch(t=>{alert(t)})}}},U={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},S={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},H={id:"productModalLabel",class:"modal-title"},L={key:0},N={key:1},R=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},O={class:"mb-3"},z=e("label",{for:"name",class:"form-label"},"優惠券名稱",-1),F={class:"mb-3"},j=e("label",{for:"tel",class:"form-label"},"折扣碼",-1),K={class:"mb-3"},G=e("label",{for:"address",class:"form-label"},"折扣%數",-1),J=e("br",null,null,-1),Q=["value"],W={class:"mb-3"},X=e("label",{for:"message",class:"form-label"},"到期日",-1),Y={class:"mb-3"},Z={class:"form-check"},ee=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),te=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{type:"submit",class:"btn btn-primary"}," 確認 ")],-1);function oe(t,o,p,v,s,c){const h=r("v-field"),_=r("error-message"),g=r("VueDatePicker"),a=r("v-form");return d(),i("div",U,[l(a,{class:"modal-dialog modal-xl",onSubmit:c.submitBtn,ref:"form"},{default:V(({errors:m})=>[e("div",S,[e("div",B,[e("h5",H,[s.isNew?(d(),i("span",L,"新增優惠券")):(d(),i("span",N,"編輯優惠券"))]),R]),e("div",q,[e("div",O,[z,l(h,{id:"name",name:"名稱",type:"text",class:k(["form-control",{"is-invalid":m.名稱}]),placeholder:"請輸入優惠卷名稱",rules:"required",modelValue:s.coupon.title,"onUpdate:modelValue":o[0]||(o[0]=n=>s.coupon.title=n)},null,8,["class","modelValue"]),l(_,{name:"名稱",class:"invalid-feedback"})]),e("div",F,[j,l(h,{id:"tel",name:"折扣碼",type:"text",class:k(["form-control",{"is-invalid":m.折扣碼}]),placeholder:"請輸入折扣碼",rules:"required",modelValue:s.coupon.code,"onUpdate:modelValue":o[1]||(o[1]=n=>s.coupon.code=n)},null,8,["class","modelValue"]),l(_,{name:"折扣碼",class:"invalid-feedback"})]),e("div",K,[G,J,l(h,{id:"address",name:"折扣數",class:k(["form-control t",{"is-invalid":m.折扣數}]),placeholder:"折扣數",rules:"required",modelValue:s.coupon.percent,"onUpdate:modelValue":o[3]||(o[3]=n=>s.coupon.percent=n)},{default:V(()=>[w(e("select",{class:"btn btn-outline-secondary","onUpdate:modelValue":o[2]||(o[2]=n=>s.coupon.percent=n)},[(d(),i($,null,x(100,n=>e("option",{key:n,value:n},b(n),9,Q)),64))],512),[[D,s.coupon.percent]]),E("% ")]),_:2},1032,["class","modelValue"]),l(_,{name:"折扣數",class:"invalid-feedback"})]),e("div",W,[X,l(g,{id:"due_date","text-input":"",format:"yyyy/MM/dd HH:mm",modelValue:s.coupon.due_date,"onUpdate:modelValue":o[4]||(o[4]=n=>s.coupon.due_date=n),"min-date":new Date,clearable:!1},null,8,["modelValue","min-date"])]),e("div",Y,[e("div",Z,[w(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[5]||(o[5]=n=>s.coupon.is_enabled=n)},null,512),[[C,s.coupon.is_enabled]]),ee])])]),te])]),_:1},8,["onSubmit"])],512)}const se=y(I,[["render",oe]]);var ne={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"ting-hexschool",BASE_URL:"/week6_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:ae,VITE_PATH:le}=ne,de={components:{Pagination:P,EditCouponModal:se,DelProductModal:T},data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"ting-hexschool",coupons:[],tempCoupon:{},pagination:{},isNew:!1}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");u.defaults.headers.common.Authorization=t,this.getData()},methods:{checkAdmin(){const t=`${this.apiUrl}/api/user/check`;u.post(t).then(()=>{this.getData()}).catch(o=>{alert(o.response.data.message),this.$router.push("/login")})},getData(t=1){const o=`${ae}/api/${le}/admin/coupons`;u.get(o).then(p=>{const{coupons:v,pagination:s}=p.data;this.coupons=v,this.pagination=s}).catch(p=>{alert(p.response.data.message),this.$router.push("/login")})},openModal(t,o){t==="new"?(this.tempCoupon={},this.isNew=!0,this.$refs.EditCouponModal.openModal(t,o)):t==="edit"?(this.tempCoupon={...o},this.isNew=!1,this.$refs.EditCouponModal.openModal(t,o)):t==="delete"&&(this.tempCoupon={...o},this.$refs.DelProductModal.openModal(t,o))}}},ie={id:"app"},ce={class:"container"},ue=e("h3",{class:"fw-bold mt-5"}," 後台優惠卷列表 ",-1),re={class:"d-flex mt-4 justify-content-between"},pe=e("div",null,null,-1),he={class:"ml-auto"},_e={class:"table mt-4"},me=e("thead",null,[e("tr",null,[e("th",{width:"120"},"優惠券名稱"),e("th",{width:"120"},"折扣碼"),e("th",{width:"120"}," 到期日 "),e("th",{width:"60"}," 優惠折數(%) "),e("th",{width:"60"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),be={class:"text-center"},fe={class:"text-center"},ve={key:0,class:"text-success"},ge={key:1},ke={class:"btn-group"},Me=["onClick"],Ve=["onClick"];function we(t,o,p,v,s,c){const h=r("Pagination"),_=r("edit-coupon-modal"),g=r("del-product-modal");return d(),i("div",ie,[e("div",ce,[ue,e("div",re,[pe,e("div",he,[e("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=a=>c.openModal("new"))}," 建立新優惠券 ")])]),e("table",_e,[me,e("tbody",null,[(d(!0),i($,null,x(s.coupons,a=>(d(),i("tr",{key:a.id},[e("td",null,b(a.title),1),e("td",null,b(a.code),1),e("td",be,b(a.due_date),1),e("td",fe,b(a.percent),1),e("td",null,[a.is_enabled?(d(),i("span",ve,"啟用")):(d(),i("span",ge,"未啟用"))]),e("td",null,[e("div",ke,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:m=>c.openModal("edit",a)}," 編輯 ",8,Me),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:m=>c.openModal("delete",a)}," 刪除 ",8,Ve)])])]))),128))])]),l(h,{pagination:s.pagination,onEmitPages:c.getData},null,8,["pagination","onEmitPages"])]),l(_,{ref:"EditCouponModal",coupon:s.tempCoupon,"is-new":s.isNew,onUpdate:c.getData},null,8,["coupon","is-new","onUpdate"]),l(g,{ref:"DelProductModal",item:s.tempCoupon,apiMethod:"coupon",onUpdate:c.getData},null,8,["item","onUpdate"])])}const De=y(de,[["render",we]]);export{De as default};
